# KSubdomain: æé€Ÿæ— çŠ¶æ€å­åŸŸåçˆ†ç ´å·¥å…·

[![Release](https://img.shields.io/github/release/boy-hack/ksubdomain.svg)](https://github.com/boy-hack/ksubdomain/releases) [![Go Report Card](https://goreportcard.com/badge/github.com/boy-hack/ksubdomain)](https://goreportcard.com/report/github.com/boy-hack/ksubdomain) [![License](https://img.shields.io/github/license/boy-hack/ksubdomain)](https://github.com/boy-hack/ksubdomain/blob/main/LICENSE)

**KSubdomain æ˜¯ä¸€æ¬¾åŸºäºæ— çŠ¶æ€æŠ€æœ¯çš„å­åŸŸåçˆ†ç ´å·¥å…·ï¼Œå¸¦æ¥å‰æ‰€æœªæœ‰çš„æ‰«æé€Ÿåº¦å’Œæä½çš„å†…å­˜å ç”¨ã€‚** å‘Šåˆ«ä¼ ç»Ÿå·¥å…·çš„æ•ˆç‡ç“¶é¢ˆï¼Œä½“éªŒé—ªç”µèˆ¬çš„ DNS æŸ¥è¯¢ï¼ŒåŒæ—¶æ‹¥æœ‰å¯é çš„é‡å‘æœºåˆ¶ï¼Œç¡®ä¿ç»“æœçš„å®Œæ•´æ€§ã€‚ KSubdomain æ”¯æŒ Windowsã€Linux å’Œ macOSï¼Œæ˜¯æ‚¨è¿›è¡Œå¤§è§„æ¨¡èµ„äº§æ¢æµ‹çš„ç†æƒ³é€‰æ‹©ã€‚

![](image.gif)

## ğŸš€ æ ¸å¿ƒä¼˜åŠ¿

*   **é—ªç”µèˆ¬çš„é€Ÿåº¦:** é‡‡ç”¨æ— çŠ¶æ€æ‰«ææŠ€æœ¯ï¼Œç›´æ¥æ“ä½œç½‘ç»œé€‚é…å™¨è¿›è¡ŒåŸå§‹å¥—æ¥å­—å‘åŒ…ï¼Œç»•è¿‡ç³»ç»Ÿå†…æ ¸çš„ç½‘ç»œåè®®æ ˆï¼Œå®ç°æƒŠäººçš„å‘åŒ…é€Ÿç‡ã€‚é€šè¿‡ `test` å‘½ä»¤å¯æ¢æµ‹æœ¬åœ°ç½‘å¡çš„æœ€å¤§å‘é€é€Ÿåº¦ã€‚
*   **æä½çš„èµ„æºæ¶ˆè€—:** åˆ›æ–°çš„å†…å­˜ç®¡ç†æœºåˆ¶ï¼ŒåŒ…æ‹¬å¯¹è±¡æ± å’Œå…¨å±€å†…å­˜æ± ï¼Œæ˜¾è‘—é™ä½å†…å­˜åˆ†é…å’Œ GC å‹åŠ›ï¼Œå³ä½¿å¤„ç†æµ·é‡åŸŸåä¹Ÿèƒ½ä¿æŒä½å†…å­˜å ç”¨ã€‚
*   **æ— çŠ¶æ€è®¾è®¡:** ç±»ä¼¼ Masscan çš„æ— çŠ¶æ€æ‰«æï¼Œä¸ç»´æŠ¤åºå¤§çš„è¿æ¥çŠ¶æ€è¡¨ï¼Œä»æ ¹æœ¬ä¸Šè§£å†³äº†ä¼ ç»Ÿæ‰«æå·¥å…·çš„å†…å­˜ç“¶é¢ˆå’Œæ€§èƒ½é™åˆ¶ã€‚
*   **å¯é çš„é‡å‘:** å†…å»ºæ™ºèƒ½é‡å‘æœºåˆ¶ï¼Œæœ‰æ•ˆåº”å¯¹ç½‘ç»œæŠ–åŠ¨å’Œä¸¢åŒ…ï¼Œç¡®ä¿ç»“æœçš„å‡†ç¡®æ€§å’Œå®Œæ•´æ€§ã€‚
*   **è·¨å¹³å°æ”¯æŒ:** å®Œç¾å…¼å®¹ Windows, Linux, macOSã€‚
*   **æ˜“äºä½¿ç”¨:** ç®€æ´çš„å‘½ä»¤è¡Œæ¥å£ï¼Œæä¾›éªŒè¯ (verify) å’Œæšä¸¾ (enum) ä¸¤ç§æ¨¡å¼ï¼Œå¹¶å†…ç½®å¸¸ç”¨å­—å…¸ã€‚

## âš¡ æ€§èƒ½äº®ç‚¹

KSubdomain åœ¨é€Ÿåº¦å’Œæ•ˆç‡ä¸Šè¿œè¶…åŒç±»å·¥å…·ã€‚ä»¥ä¸‹æ˜¯åœ¨ 4 æ ¸ CPUã€5M å¸¦å®½ç½‘ç»œç¯å¢ƒä¸‹ï¼Œä½¿ç”¨ 10 ä¸‡å­—å…¸è¿›è¡Œçš„å¯¹æ¯”æµ‹è¯•ï¼š

| å·¥å…·         | æ‰«ææ¨¡å¼ | å‘åŒ…æ–¹å¼     | å‘½ä»¤                                                                       | è€—æ—¶           | æˆåŠŸä¸ªæ•° | å¤‡æ³¨                      |
| ------------ | -------- | ------------ | -------------------------------------------------------------------------- | -------------- | -------- | ------------------------- |
| **KSubdomain** | éªŒè¯     | pcap ç½‘å¡å‘åŒ… | `time ./ksubdomain v -b 5m -f d2.txt -o k.txt -r dns.txt --retry 3 --np`  | **~30 ç§’**     | 1397     | `--np` å…³é—­å®æ—¶æ‰“å°       |
| massdns      | éªŒè¯     | pcap/socket  | `time ./massdns -r dns.txt -t A -w m.txt d2.txt --root -o L`                 | ~3 åˆ† 29 ç§’    | 1396     |                           |
| dnsx         | éªŒè¯     | socket       | `time ./dnsx -a -o d.txt -r dns.txt -l d2.txt -retry 3 -t 5000`             | ~5 åˆ† 26 ç§’    | 1396     | `-t 5000` è®¾ç½® 5000 å¹¶å‘ |

**ç»“è®º:** KSubdomain çš„é€Ÿåº¦æ˜¯ massdns çš„ **7 å€**ï¼Œæ˜¯ dnsx çš„ **10 å€** ä»¥ä¸Šï¼

## ğŸ› ï¸ æŠ€æœ¯é©æ–° (v2.0)

KSubdomain 2.0 ç‰ˆæœ¬å¼•å…¥äº†å¤šé¡¹åº•å±‚ä¼˜åŒ–ï¼Œè¿›ä¸€æ­¥å‹æ¦¨æ€§èƒ½æ½œåŠ›ï¼š

1.  **çŠ¶æ€è¡¨ä¼˜åŒ–:**
    *   **åˆ†ç‰‡é” (Sharded Lock):** æ›¿ä»£å…¨å±€é”ï¼Œå¤§å¹…å‡å°‘é”ç«äº‰ï¼Œæé«˜å¹¶å‘å†™å…¥æ•ˆç‡ã€‚
    *   **é«˜æ•ˆå“ˆå¸Œ:** ä¼˜åŒ–é”®å€¼å­˜å‚¨ï¼Œå‡åŒ€åˆ†å¸ƒåŸŸåï¼Œæå‡æŸ¥æ‰¾é€Ÿåº¦ã€‚
2.  **å‘åŒ…æœºåˆ¶ä¼˜åŒ–:**
    *   **å¯¹è±¡æ± :** å¤ç”¨ DNS åŒ…ç»“æ„ä½“ï¼Œå‡å°‘å†…å­˜åˆ†é…å’Œ GC å¼€é”€ã€‚
    *   **æ¨¡æ¿ç¼“å­˜:** ä¸ºç›¸åŒ DNS æœåŠ¡å™¨å¤ç”¨ä»¥å¤ªç½‘/IP/UDP å±‚æ•°æ®ï¼Œå‡å°‘é‡å¤æ„å»ºå¼€é”€ã€‚
    *   **å¹¶è¡Œå‘é€:** å¤šåç¨‹å¹¶è¡Œå‘åŒ…ï¼Œå……åˆ†åˆ©ç”¨å¤šæ ¸ CPU æ€§èƒ½ã€‚
    *   **æ‰¹é‡å¤„ç†:** æ‰¹é‡å‘é€åŸŸåè¯·æ±‚ï¼Œå‡å°‘ç³»ç»Ÿè°ƒç”¨å’Œä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚
3.  **æ¥æ”¶æœºåˆ¶ä¼˜åŒ–:**
    *   **å¯¹è±¡æ± :** å¤ç”¨è§£æå™¨å’Œç¼“å†²åŒºï¼Œé™ä½å†…å­˜æ¶ˆè€—ã€‚
    *   **å¹¶è¡Œå¤„ç†ç®¡é“:** æ¥æ”¶ â†’ è§£æ â†’ å¤„ç†ä¸‰é˜¶æ®µå¹¶è¡Œï¼Œæé«˜å¤„ç†æµæ°´çº¿æ•ˆç‡ã€‚
    *   **ç¼“å†²åŒºä¼˜åŒ–:** å¢åŠ å†…éƒ¨ Channel ç¼“å†²åŒºå¤§å°ï¼Œé¿å…å¤„ç†é˜»å¡ã€‚
    *   **é«˜æ•ˆè¿‡æ»¤:** ä¼˜åŒ– BPF è¿‡æ»¤è§„åˆ™å’ŒåŒ…å¤„ç†é€»è¾‘ï¼Œå¿«é€Ÿä¸¢å¼ƒæ— æ•ˆæ•°æ®åŒ…ã€‚
4.  **å†…å­˜ç®¡ç†ä¼˜åŒ–:**
    *   **å…¨å±€å†…å­˜æ± :** å¼•å…¥ `sync.Pool` ç®¡ç†å¸¸ç”¨æ•°æ®ç»“æ„ï¼Œå‡å°‘å†…å­˜åˆ†é…å’Œç¢ç‰‡ã€‚
    *   **ç»“æ„å¤ç”¨:** å¤ç”¨ DNS æŸ¥è¯¢ç»“æ„å’Œåºåˆ—åŒ–ç¼“å†²åŒºã€‚
5.  **æ¶æ„ä¸å¹¶å‘ä¼˜åŒ–:**
    *   **åŠ¨æ€å¹¶å‘:** æ ¹æ® CPU æ ¸å¿ƒæ•°è‡ªåŠ¨è°ƒæ•´åç¨‹æ•°é‡ã€‚
    *   **é«˜æ•ˆéšæœºæ•°:** ä½¿ç”¨æ€§èƒ½æ›´ä¼˜çš„éšæœºæ•°ç”Ÿæˆå™¨ã€‚
    *   **è‡ªé€‚åº”é€Ÿç‡:** æ ¹æ®ç½‘ç»œçŠ¶å†µå’Œç³»ç»Ÿè´Ÿè½½åŠ¨æ€è°ƒæ•´å‘åŒ…é€Ÿç‡ã€‚
    *   **æ‰¹é‡åŠ è½½:** æ‰¹é‡åŠ è½½å’Œå¤„ç†åŸŸåï¼Œé™ä½å•ä¸ªåŸŸåå¤„ç†çš„å›ºå®šå¼€é”€ã€‚

## ğŸ“¦ å®‰è£…

1.  **ä¸‹è½½é¢„ç¼–è¯‘äºŒè¿›åˆ¶æ–‡ä»¶:** å‰å¾€ [Releases](https://github.com/boy-hack/ksubdomain/releases) é¡µé¢ä¸‹è½½å¯¹åº”ç³»ç»Ÿçš„æœ€æ–°ç‰ˆæœ¬ã€‚
2.  **å®‰è£… `libpcap` ä¾èµ–:**
    *   **Windows:** ä¸‹è½½å¹¶å®‰è£… [Npcap](https://npcap.com/) é©±åŠ¨ (WinPcap å¯èƒ½æ— æ•ˆ)ã€‚
    *   **Linux:** å·²é™æ€ç¼–è¯‘æ‰“åŒ… `libpcap`ï¼Œé€šå¸¸æ— éœ€é¢å¤–æ“ä½œã€‚è‹¥é‡é—®é¢˜ï¼Œè¯·å°è¯•å®‰è£… `libpcap-dev` æˆ– `libcap-devel` åŒ…ã€‚
    *   **macOS:** ç³»ç»Ÿè‡ªå¸¦ `libpcap`ï¼Œæ— éœ€å®‰è£…ã€‚
3.  **èµ‹äºˆæ‰§è¡Œæƒé™ (Linux/macOS):** `chmod +x ksubdomain`
4.  **è¿è¡Œ!**

### æºç ç¼–è¯‘ (å¯é€‰)

ç¡®ä¿æ‚¨å·²å®‰è£… Go 1.17+ ç‰ˆæœ¬å’Œ `libpcap` ç¯å¢ƒã€‚

```bash
go install -v github.com/boy-hack/ksubdomain/cmd/ksubdomain@latest
# äºŒè¿›åˆ¶æ–‡ä»¶é€šå¸¸ä½äº $GOPATH/bin æˆ– $HOME/go/bin
```

## ğŸ“– ä½¿ç”¨è¯´æ˜

```bash
KSubdomain - æé€Ÿæ— çŠ¶æ€å­åŸŸåçˆ†ç ´å·¥å…·

ç”¨æ³•:
  ksubdomain [å…¨å±€é€‰é¡¹] å‘½ä»¤ [å‘½ä»¤é€‰é¡¹] [å‚æ•°...]

ç‰ˆæœ¬:
  æŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯: ksubdomain --version

å‘½ä»¤:
  enum, e    æšä¸¾æ¨¡å¼: æä¾›ä¸»åŸŸåè¿›è¡Œçˆ†ç ´
  verify, v  éªŒè¯æ¨¡å¼: æä¾›åŸŸååˆ—è¡¨è¿›è¡ŒéªŒè¯
  test       æµ‹è¯•æœ¬åœ°ç½‘å¡æœ€å¤§å‘åŒ…é€Ÿåº¦
  help, h    æ˜¾ç¤ºå‘½ä»¤åˆ—è¡¨æˆ–æŸä¸ªå‘½ä»¤çš„å¸®åŠ©

å…¨å±€é€‰é¡¹:
  --help, -h     æ˜¾ç¤ºå¸®åŠ© (é»˜è®¤: false)
  --version, -v  æ‰“å°ç‰ˆæœ¬ä¿¡æ¯ (é»˜è®¤: false)
```

### éªŒè¯æ¨¡å¼ (Verify)

éªŒè¯æ¨¡å¼ç”¨äºå¿«é€Ÿæ£€æŸ¥æä¾›çš„åŸŸååˆ—è¡¨çš„å­˜æ´»çŠ¶æ€ã€‚

```bash
./ksubdomain verify -h # æŸ¥çœ‹éªŒè¯æ¨¡å¼å¸®åŠ©

# å¸¸ç”¨é€‰é¡¹:
# -f value: æŒ‡å®šåŒ…å«åŸŸååˆ—è¡¨çš„æ–‡ä»¶è·¯å¾„
# -r value: æŒ‡å®š DNS æœåŠ¡å™¨åˆ—è¡¨æ–‡ä»¶è·¯å¾„ (ä¸€è¡Œä¸€ä¸ª)
# -b value: è®¾ç½®å‡ºå£å¸¦å®½ (ä¾‹å¦‚: 10M, 5K, 1G), KSubdomain ä¼šè‡ªåŠ¨è°ƒæ•´å‘åŒ…é€Ÿç‡ (é»˜è®¤: "2m")
# -o value: æŒ‡å®šè¾“å‡ºç»“æœçš„æ–‡ä»¶å
# --silent: é™é»˜æ¨¡å¼ï¼Œå±å¹•åªè¾“å‡ºæ‰¾åˆ°çš„åŸŸå
# --retry value: DNS æŸ¥è¯¢é‡è¯•æ¬¡æ•° (é»˜è®¤: 3), -1 è¡¨ç¤ºæ— é™é‡è¯•
# --timeout value: DNS æŸ¥è¯¢è¶…æ—¶æ—¶é—´ (ç§’) (é»˜è®¤: 6)
# --stdin: ä»æ ‡å‡†è¾“å…¥è¯»å–åŸŸå
# --od: åªè¾“å‡ºåŸŸåï¼Œä¸æ˜¾ç¤º IP åœ°å€
# --np: ä¸åœ¨å±å¹•ä¸Šæ‰“å°ç»“æœ (é…åˆ -o ä½¿ç”¨)
# --dns-type value: æŸ¥è¯¢çš„ DNS è®°å½•ç±»å‹ (1: A, 2: NS, 5: CNAME, 16: TXT, ...) (é»˜è®¤: 1)

# ç¤ºä¾‹:
# ä»æ–‡ä»¶è¯»å–åŸŸåè¿›è¡ŒéªŒè¯ï¼Œä½¿ç”¨ resolvers.txt ä¸­çš„ DNS æœåŠ¡å™¨
./ksubdomain v -f domains.txt -r resolvers.txt

# ä»æ ‡å‡†è¾“å…¥è¯»å–åŸŸåï¼Œå¸¦å®½é™åˆ¶ä¸º 10M
cat domains.txt | ./ksubdomain v --stdin -b 10M

# éªŒè¯ NS è®°å½•
echo "example.com" | ./ksubdomain v --stdin --dns-type 2
```

### æšä¸¾æ¨¡å¼ (Enum)

æšä¸¾æ¨¡å¼ç”¨äºçˆ†ç ´æŒ‡å®šåŸŸåä¸‹çš„å­åŸŸåã€‚

```bash
./ksubdomain enum -h # æŸ¥çœ‹æšä¸¾æ¨¡å¼å¸®åŠ©

# å¸¸ç”¨é€‰é¡¹ (éƒ¨åˆ†åŒéªŒè¯æ¨¡å¼):
# -d value: æŒ‡å®šè¦çˆ†ç ´çš„ä¸»åŸŸå (ä¾‹å¦‚: example.com)
# --dl value: æŒ‡å®šåŒ…å«ä¸»åŸŸåçš„æ–‡ä»¶åˆ—è¡¨
# -f value: æŒ‡å®šå­åŸŸåå­—å…¸æ–‡ä»¶è·¯å¾„ (ä¸æŒ‡å®šåˆ™ä½¿ç”¨å†…ç½® 10 ä¸‡å­—å…¸)
# -l value: æšä¸¾çš„åŸŸåå±‚çº§ (é»˜è®¤: 2, å³æšä¸¾äºŒçº§åŸŸå www.example.com)
# --ld value: å½“ level > 2 æ—¶ï¼Œç”¨äºæšä¸¾æ›´æ·±å±‚çº§çš„å­—å…¸æ–‡ä»¶ (å¯é€‰)
# --skip-wild: è·³è¿‡æ£€æµ‹åˆ°çš„æ³›è§£æåŸŸå (é»˜è®¤: false)

# ç¤ºä¾‹:
# æšä¸¾ baidu.com çš„äºŒçº§åŸŸåï¼Œä½¿ç”¨å†…ç½®å­—å…¸
./ksubdomain e -d baidu.com

# ä»æ–‡ä»¶è¯»å–ä¸»åŸŸååˆ—è¡¨è¿›è¡Œæšä¸¾
./ksubdomain e --dl domains_to_enum.txt

# æšä¸¾ä¸‰çº§åŸŸåï¼Œå¹¶æŒ‡å®šå±‚çº§å­—å…¸
./ksubdomain e -d example.com -l 3 --ld third_level_dict.txt
```

## âœ¨ ç‰¹æ€§ä¸æŠ€å·§

*   **å¸¦å®½è‡ªåŠ¨é€‚é…:** åªéœ€ä½¿ç”¨ `-b` å‚æ•°æŒ‡å®šä½ çš„å…¬ç½‘ä¸‹è¡Œå¸¦å®½ (å¦‚ `-b 10m`), KSubdomain ä¼šè‡ªåŠ¨ä¼˜åŒ–å‘åŒ…é€Ÿç‡ã€‚
*   **æµ‹è¯•æœ€å¤§é€Ÿç‡:** è¿è¡Œ `./ksubdomain test` æµ‹è¯•å½“å‰ç¯å¢ƒçš„æœ€å¤§ç†è®ºå‘åŒ…é€Ÿç‡ã€‚
*   **è‡ªåŠ¨ç½‘å¡æ£€æµ‹:** KSubdomain ä¼šè‡ªåŠ¨æ£€æµ‹å¯ç”¨ç½‘å¡ã€‚å¯é€šè¿‡ç¯å¢ƒå˜é‡ `KSubdomainEth` æŒ‡å®šç½‘å¡ï¼Œæˆ–é€šè¿‡é…ç½®æ–‡ä»¶è®¾ç½®ã€‚
*   **è¿›åº¦æ˜¾ç¤º:** å®æ—¶è¿›åº¦æ¡æ˜¾ç¤º æˆåŠŸæ•° / å‘é€æ•° / é˜Ÿåˆ—é•¿åº¦ / æ¥æ”¶æ•° / å¤±è´¥æ•° / å·²è€—æ—¶ã€‚
*   **å‚æ•°è°ƒä¼˜:** æ ¹æ®ç½‘ç»œè´¨é‡å’Œç›®æ ‡åŸŸåæ•°é‡ï¼Œè°ƒæ•´ `--retry` å’Œ `--timeout` å‚æ•°ä»¥è·å¾—æœ€ä½³æ•ˆæœã€‚å½“ `--retry` ä¸º -1 æ—¶ï¼Œå°†æ— é™é‡è¯•ç›´è‡³æ‰€æœ‰è¯·æ±‚æˆåŠŸæˆ–è¶…æ—¶ã€‚
*   **æ³›è§£æè¿‡æ»¤:** æ”¯æŒè‡ªåŠ¨æ£€æµ‹å¹¶è¿‡æ»¤æ³›è§£æåŸŸå (æšä¸¾æ¨¡å¼ä¸‹ä½¿ç”¨ `--skip-wild`)ã€‚
*   **å¤šç§è¾“å‡ºæ ¼å¼:** æ”¯æŒ `txt` (å®æ—¶è¾“å‡º), `json` (å®Œæˆåè¾“å‡º), `csv` (å®Œæˆåè¾“å‡º)ã€‚é€šè¿‡ `-o` æŒ‡å®šæ–‡ä»¶ååç¼€å³å¯ (å¦‚ `result.json`)ã€‚
*   **ç¯å¢ƒå˜é‡é…ç½®:**
    *   `KSubdomainConfig`: æŒ‡å®šé…ç½®æ–‡ä»¶çš„è·¯å¾„ã€‚
    *   `KSubdomainEth`: æŒ‡å®šä½¿ç”¨çš„ç½‘å¡åç§° (ä¾‹å¦‚ `eth0`)ã€‚

## ğŸ’¡ å‚è€ƒ

*   åŸ KSubdomain é¡¹ç›®: [https://github.com/knownsec/ksubdomain](https://github.com/knownsec/ksubdomain)
*   ä» Masscan, Zmap æºç åˆ†æåˆ°å¼€å‘å®è·µ: [https://paper.seebug.org/1052/](https://paper.seebug.org/1052/)
*   KSubdomain æ— çŠ¶æ€åŸŸåçˆ†ç ´å·¥å…·ä»‹ç»: [https://paper.seebug.org/1325/](https://paper.seebug.org/1325/)
*   KSubdomain ä¸ massdns çš„å¯¹æ¯”åˆ†æ: [å¾®ä¿¡å…¬ä¼—å·æ–‡ç« é“¾æ¥](https://mp.weixin.qq.com/s?__biz=MzU2NzcwNTY3Mg==&mid=2247484471&idx=1&sn=322d5db2d11363cd2392d7bd29c679f1&chksm=fc986d10cbefe406f4bda22f62a16f08c71f31c241024fc82ecbb8e41c9c7188cfbd71276b81&token=76024279&lang=zh_CN#rd)